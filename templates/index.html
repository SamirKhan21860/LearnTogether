{% extends "layout.html" %}

{% block title %}
Results
{% endblock %}

{% block index %}

<body class="bg-[rgb(240,228,252)] font-sans">



    <!-- Table-like bar for multiple pages -->
    <main class="flex flex-col h-full">
        <div class="navigationBar flex justify-center flex-col text-white m-4 md:flex-row">
            <div class="navItem cursor-pointer" onclick="showPage('announcements')">
                <div class="title p-2 bg-gray-600">Announcements</div>
                <div class="description p-2 bg-purple-500 md:block hidden">Important updates</div>
            </div>
            <div class="navItem cursor-pointer" onclick="showPage('classTiming')">
                <div class="title p-2 bg-gray-500">Class Timing</div>
                <div class="description p-2 bg-purple-600 md:block hidden">Organized templates</div>
            </div>
            <div class="navItem cursor-pointer" onclick="showPage('assignments')">
                <div class="title p-2 bg-gray-600">Assignments</div>
                <div class="description p-2 bg-purple-500 md:block hidden">Practical details</div>
            </div>
            <div class="navItem cursor-pointer" onclick="showPage('studyMaterials')">
                <div class="title p-2 bg-gray-500">Study Materials</div>
                <div class="description p-2 bg-purple-600 md:block hidden">Self-Study, e-Learning</div>
            </div>
            <div class="navItem cursor-pointer" onclick="showPage('scholarshipOpportunities')">
                <div class="title p-2 bg-gray-700">Scholarship Opportunities</div>
                <div class="description p-2 bg-purple-700 md:block hidden">Job Opportunities</div>
            </div>
        </div>

        <!-- Multiple pages layout -->
        <div id="switchPages" class="switchPages flex justify-center flex-wrap">

            <div id="page-announcements"
                class="page p-4 m-4 bg-purple-300 rounded-md flex items-start justify-center hidden">
                <div class="p-4 bg-white rounded-full text-center">
                    <h2 class="title">Announcements</h2>
                </div>
            </div>

            <div id="page-classTiming"
                class="page p-4 m-4 bg-purple-400 rounded-md flex items-start justify-center hidden">
                <div class="p-4 bg-white rounded-full text-center">
                    <h2>Class Timing</h2>
                </div>
            </div>

            <div id="page-assignments"
                class="page p-4 m-4 bg-amber-300 rounded-md overflow-y-auto flex flex-col items-center justify-center hidden">
                <div class="p-4 mt-10 bg-white rounded-full text-center">
                    <h2>Assignments</h2>
                </div>

                <!-- Assignment Form -->
                <form action="/assign" method="post">
                    <div class="grid grid-cols-2 gap-4 mt-4" id="inputAssignment">
                        <div class="mb-4">
                            <input type="text" id="assignment_name" name="assignment_name" placeholder="Name"
                                class="shadow appearance-none border rounded-full text-center items-center py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
                        </div>
                        <div class="mb-6">
                            <input id="subject" name="subject" placeholder="Subject?"
                                class="shadow appearance-none border rounded-full text-center items-center py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
                        </div>
                        <div class="mb-4">
                            <textarea id="assignment_description" name="assignment_description"
                                placeholder="Take a key Note"
                                class="shadow appearance-none border rounded-lg text-center items-center w-md py-2 px-3 leading-tight focus:outline-none focus:shadow-outline"></textarea>
                        </div>
                        <div class="flex items-center justify-start">
                            <button type="submit"
                                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Add
                                Assignment</button>
                        </div>
                </form>
            </div>


            <!-- Display Added Assignments -->
            <div class="mt-8">
                <h3 class="text-xl font-bold mb-4">Added Assignments:</h3>
                <table class="min-w-full table-auto bg-amber-100">
                    <thead>
                        <tr>
                            <th class="border px-4 py-2">Name</th>
                            <th class="border px-4 py-2">Subject</th>
                            <th class="border px-4 py-2">Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for assign in assignment %}
                        <tr>
                            <td class="border px-4 py-2">{{ assign.name }}</td>
                            <td class="border px-4 py-2">{{ assign.subject }}</td>
                            <td class="border px-4 py-2">{{ assign.description }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

        </div>

        <div id="page-studyMaterials"
            class="page pl-6 m-4 bg-purple-600 rounded-md flex flex-col items-center justify-center">
            <div class="p-4 bg-white rounded-full text-center">
                <h2>Study Materials</h2>
            </div>
            <button id="fetchNumbersButton">Fetch New Data</button>
            <div id="study-cards" class="container grid grid-cols-3 gap-4 mx-auto text-white ml-4 mt-8 mb-8">
                <div
                    class="content p-4 hover:p-6 rounded-lg bg-purple-400 w-40 hover:w-48 hover:h-48 shadow shadow-2xl opacity-75 hover:opacity-100 h-40 transition-all duration-300">
                    <h3>Heading 1</h3>
                </div>
                <div
                    class="content p-4 hover:p-6 rounded-lg bg-purple-500 w-40 hover:w-48 hover:h-48 shadow shadow-2xl opacity-75 hover:opacity-100 h-40 transition-all duration-300">
                    <h3>Heading 2</h3>
                </div>
                <div
                    class="content p-4 hover:p-6 rounded-lg bg-purple-300 w-40 hover:w-48 hover:h-48 shadow shadow-2xl opacity-75 hover:opacity-100 h-40 transition-all duration-300">
                    <h3>Heading 3</h3>
                </div>
                <div
                    class="content p-4 hover:p-6 rounded-lg bg-purple-300 w-40 hover:w-48 hover:h-48 shadow shadow-2xl opacity-75 hover:opacity-100 h-40 transition-all duration-300">
                    <h3>Heading 4</h3>
                </div>
                <div
                    class="content p-4 hover:p-6 rounded-lg bg-purple-500 w-40 hover:w-48 hover:h-48 shadow shadow-2xl opacity-75 hover:opacity-100 h-40 transition-all duration-300">
                    <h3>Heading 5</h3>
                </div>
                <div
                    class="content p-4 hover:p-6 rounded-lg bg-purple-400 w-40 hover:w-48 hover:h-48 shadow shadow-2xl opacity-75 hover:opacity-100 h-40 transition-all duration-300">
                    <h3>Heading 6</h3>
                </div>
            </div>
        </div>

        <!-- <div id="page-scholarshipOpportunities"
                class="page p-4 m-4 bg-purple-700 rounded-md flex flex-col items-center justify-center">
                <div class="p-4 bg-white rounded-full w-auto text-center">
                    <h2>Opportunities</h2>
                </div>
                <div id="jobSearchForm">
                    <form action="/" method="post">
                        <input type="search" name="job" id="job" autofocus autocomplete="off"
                            placeholder="Search for job"
                            class="p-4 m-4 rounded-3xl focus:rounded-full bg-rose-200 placeholder:text-indigo-800 focus:outline-none focus:ring focus:ring-lime-200">
                        <button type="submit"
                            class="bg-blue-500 text-white p-4 rounded-xl hover:bg-blue-600 focus:outline-none focus:border-blue-700 focus:ring focus:ring-blue-200 transition duration-300">Search</button>
                    </form>
                </div>
            </div> -->
        <div id="page-scholarshipOpportunities"
            class="page p-4 m-4 bg-purple-700 rounded-md flex flex-col items-center justify-start hidden">
            <div class="p-4 bg-white rounded-full w-auto text-center">
                <h2>Opportunities</h2>
            </div>
            <div class="serach ml-16 mt-2" id="search">
                <form id="jobSearchForm">
                    <input type="search" name="job" id="job" autofocus autocomplete="off" placeholder="Search for a job"
                        class="p-3 m-4 rounded-3xl focus:rounded-full bg-rose-200 placeholder:text-indigo-800 focus:outline-none focus:ring focus:ring-lime-200">
                    <button type="submit"
                        class="bg-blue-500 text-white p-4 rounded-xl hover:bg-blue-600 focus:outline-none focus:border-blue-700 focus:ring focus:ring-blue-200 transition duration-300">Search</button>
                </form>
            </div>

            <!-- Job-Cards -->
            <div class="jobContainer" id="jobGridContainer">

            </div>
        </div>

        </div>

    </main>



    <!-- Flash messages -->
    <!-- <div id="flash-container" class="absolute top-0 right-0">
    </div> -->

    <!-- Included the JavaScript Logic to handle flash messages dynamically -->
    <script>
        function showPage(pageId) {
            const switchPages = document.getElementById('switchPages');
            const pages = document.querySelectorAll('.page');

            pages.forEach(page => {
                if (page.id === `page-${pageId}`) {
                    page.classList.remove('hidden');
                } else {
                    page.classList.add('hidden');
                }
            });
        }

        /* function showPage(pageId) {
            const switchPages = document.getElementById('switchPages');
            const selectedPage = document.getElementById(`page-${pageId}`);

            // Calculate the left offset to slide the selected page into view
            const leftOffset = selectedPage.offsetLeft;

            // Slide to the selected page
            switchPages.scrollTo({ left: leftOffset, behavior: 'smooth' });
        } */

        // Mapping of categories to Tailwind CSS classes
        const categoryStyles = {
            'error': 'bg-red-500',
            'info': 'bg-blue-500',
            'success': 'bg-green-500',
            'default': 'bg-gray-500'
        };

        // element dynamically using JavaScript if it doesn't exist in the HTML
        function showFlashMessage(message, category) {
            // Create or get the flash container
            var flashContainer = document.getElementById("flash-container");
            if (!flashContainer) {
                flashContainer = document.createElement("div");
                flashContainer.id = "flash-container";
                flashContainer.classList.add("absolute", "top-0", "right-0");
                document.body.appendChild(flashContainer);
            } else {
                // if flash_container exist then clear
                while (flashContainer.firstChild) {
                    flashContainer.removeChild(flashContainer.firstChild);
                }
            }

            // Now create a new flash message div element
            var flashMessage = document.createElement("div");
            flashMessage.classList.add(
                "m-4",
                "p-4",
                "hover:bg-opacity-50",
                "rounded-md",
                categoryStyles[category],
                "bg-green-500",
                "bg-opacity-75",
                "text-white",
                "transition-all",
                "duration-300",
                "ease-in-out",
                "text-white"
            );

            // Content of the flash message
            flashMessage.innerHTML = `<span class="mr-2">${message}</span><button class="text-white font-bold font-mono text-lg" onclick="closeFlashMessage(this.parentElement)">X</button>`;

            // Append the flash message to the container
            flashContainer.appendChild(flashMessage);

            // Using timeout to automatically remove the flash message after 5 seconds
            setTimeout(function () {
                closeFlashMessage(flashMessage);
            }, 3900);
        }

        function closeFlashMessage(flashMessage) {
            // Slide out the flash message
            flashMessage.style.transition = 'transform 0.3s ease-in-out';
            flashMessage.style.transform = 'translateX(110%)';

            // Remove the lement from the DOM after the transition completes
            flashMessage.addEventListener('transitionend', function () {
                flashMessage.remove();
            });
        }

        // Array of topics for query
        const topicsList = [
            'computer',
            'computer science',
            'maths',
            'geometry',
            'Muslims scientist',
            'physics',
            'chemistry',
            'biology',
            'AI',
            'learning',
            // Add more topics as needed
        ];

        // Function to fetch data for a specific topic
        async function fetchDataForTopic(topic) {
            const apiKey = 'e7d2a943f2mshab5d5c0085b1ddcp144bf7jsnbb359a3107a0';
            const apiUrl = `https://wikipedia-api1.p.rapidapi.com/get_summary?q=${topic}&lang=en&sentences=3`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'X-RapidAPI-Key': apiKey,
                        'X-RapidAPI-Host': 'wikipedia-api1.p.rapidapi.com'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('Raw Response for', topic, ':', data);

                    return {
                        name: topic,
                        data: data.data
                    };
                } else {
                    console.error('Error fetching data for', topic, ':', response.status, response.statusText);
                    return null;
                }
            } catch (error) {
                console.error('Error fetching data for', topic, ':', error);
                return null;
            }
        }

        // Function to fetch data for random topics
        async function fetchRandomTopics() {
            const selectedTopics = [];
            const delay = 1000;
            while (selectedTopics.length < 6 && topicsList.length > 0) {
                const randomIndex = Math.floor(Math.random() * topicsList.length);
                const randomTopic = topicsList.splice(randomIndex, 1)[0];
                const topicData = await fetchDataForTopic(randomTopic);
                if (topicData) {
                    selectedTopics.push(topicData);
                }
            }
            for (const topic of topicsList) {
                const topicData = await fetchDataForTopic(topic);
                if (topicData) {
                    selectedTopics.push(topicData);
                }

                // Introduce a delay between requests
                await new Promise(resolve => setTimeout(resolve, delay));
            }
            return selectedTopics;
        }


        // Fetch and display Flask flash messages
        document.addEventListener("DOMContentLoaded", function () {
            /* Study Material */
            const fetchTopicsButton = document.getElementById('fetchTopicsButton');
            const container = document.getElementById('study-cards');

            // Function to update study cards with fetched data
            async function updateStudyCards() {
                const selectedTopics = await fetchRandomTopics();
                const studyCardElements = container.getElementsByClassName('content');
                Array.from(studyCardElements).forEach((studyCard, index) => {
                    const topic = selectedTopics[index];

                    // Display the data on the study card
                    if (topic) {
                        studyCard.innerHTML = `
                    <h3 class="mb-4">${topic.name}</h3>
                    <p>${topic.data}</p>
                `;
                    }
                });
                console.log('Data fetched successfully for random topics:', selectedTopics);
            }

            // Fetch initial data when the page loads
            updateStudyCards();

            // Fetch new data when the user clicks on the button
            fetchTopicsButton.addEventListener('click', updateStudyCards);

            /* Oppertunities */
            /* I want to add a logic (when page loads the default job value should taken by api and show jobs on opportunities) */
            const jobSearchForm = document.getElementById('jobSearchForm');
            const opportunitiesContainer = document.getElementById('page-scholarshipOpportunities');
            const jobGridContainer = document.getElementById('jobGridContainer');

            jobSearchForm.addEventListener('submit', function (event) {
                event.preventDefault();

                // Get the job query from the form
                const jobQuery = document.getElementById('job').value;

                // Fetch jobs based on the user's query
                fetchJobs(jobQuery);
            });

            // Function to fetch jobs and display them
            function fetchJobs(query) {
                const apiUrl = `https://jsearch.p.rapidapi.com/search?query=${query}&page=1&num_pages=1`;

                fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'X-RapidAPI-Key': '648d1a0acamsheeb1c88c3ed9679p1b37ecjsn2133e3d076b0',
                        'X-RapidAPI-Host': 'jsearch.p.rapidapi.com'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        // Clear previous job cards
                        jobGridContainer.innerHTML = '';


                        // const jobGridContainer = document.createElement('div');
                        jobGridContainer.classList.add('rounded-md', 'overflow-auto', 'grid', 'grid-cols-1', 'md:grid-cols-2', 'lg:grid-cols-3', 'gap-4');

                        // Display new job cards
                        data.data.forEach(job => {
                            const jobCard = document.createElement('div');
                            jobCard.classList.add('job-card', 'p-4', 'bg-white', 'rounded-md', 'my-4', 'flex', 'flex-col', 'justify-between');

                            const shortDescription = truncateDescription(job.job_description, 150);

                            jobCard.innerHTML = `
                            <img src="${job.employer_logo}" alt="${job.employer_name}" class="mb-2" style="max-width: 50px;">
                            <h3 class="text-xl font-semibold">${job.job_title}</h3>
                            <p class="text-gray-600">${job.employer_name} - ${job.job_city}, ${job.job_state}</p>
                            <p class="mt-2">${shortDescription}</p>
                            <a href="${job.job_apply_link}" target="_blank" class="text-blue-500 hover:underline block mt-2">Apply Now</a>
                        `;

                            jobGridContainer.appendChild(jobCard);
                            // opportunitiesContainer.appendChild(jobCard);
                            console.log("Fetch data successfully")
                        });
                        // opportunitiesContainer.appendChild(jobGridContainer);
                    })
                    .catch(error => {
                        console.error('Error fetching jobs:', error);
                    });
            }

            function truncateDescription(description, maxLength) {
                if (description.length > maxLength) {
                    return `${description.substring(0, maxLength)}...`;
                }
                return description;
            }

            // The .parse() will convert it to the object
            var flashMessages = JSON.parse('{{ get_flashed_messages() | tojson | safe }}');

            // Check if have any messages to show
            if (flashMessages) {
                flashMessages.forEach(function (message) {
                    // at index 0: message and index 1: category
                    showFlashMessage(message[0], message[1]);
                });
            }
        });

    </script>

</body>

{% endblock %}